<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microgrid Hacker | Extreme Analytics</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">
    <!-- PDF EXPORT LIBRARIES -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>

<body>
    <div class="app-wrapper">
        <!-- HEADER HUD -->
        <header class="hud-header">
            <div class="logo">
                <i class="fas fa-microchip"></i>
                <div class="logo-text">
                    <h1>MICROGRID<span>HACKER</span></h1>
                    <p>EXTREME ANALYTICS v3.0</p>
                </div>
            </div>

            <div class="day-nav">
                <button id="prev-day"><i class="fas fa-caret-left"></i></button>
                <div id="current-day-label">DAY 1</div>
                <button id="next-day"><i class="fas fa-caret-right"></i></button>
            </div>

            <div class="hud-stats">
                <div class="stat-item">
                    <span class="label">Clock</span>
                    <span class="value" id="sim-clock">00:00</span>
                </div>
                <div class="stat-item">
                    <span class="label">Current Cost</span>
                    <span class="value" id="hud-cost" style="color: var(--primary);">â‚¹0</span>
                </div>
            </div>
        </header>

        <main class="main-layout">
            <!-- LEFT: VISUALS & ANALYTICS -->
            <section class="vis-section">
                <!-- VIRTUAL TWIN -->
                <div class="environment-box env-sunny">
                    <div id="sun-container" class="sun-orbit">
                        <div class="sun-icon"><i class="fas fa-sun"></i></div>
                    </div>

                    <!-- ANIMATION LAYERS -->
                    <div class="rain" id="rain-layer"></div>
                    <div class="clouds" id="cloud-layer"></div>

                    <!-- NEW: APPLIANCE STATUS -->
                    <div id="appliance-tag">Idle</div>

                    <div class="infrastructure">
                        <!-- SOLAR -->
                        <div class="comp-box" id="solar-box">
                            <img src="components/solar.png" alt="Solar" class="comp-img">
                            <div class="kw-tag" id="val-solar">0.0 kW</div>
                            <h3>Sunny</h3>
                            <div class="side-right"></div>
                        </div>

                        <!-- HOUSE -->
                        <div class="comp-box" id="house-box">
                            <img src="components/house.png" alt="House" class="comp-img">
                            <div class="kw-tag" id="val-load">0.0 kW</div>
                            <h3>House</h3>
                            <div class="side-right"></div>
                        </div>

                        <!-- BATTERY -->
                        <div class="comp-box" id="batt-box">
                            <img src="components/battery.png" alt="Battery" class="comp-img">
                            <div class="kw-tag" id="val-soc">50%</div>
                            <h3>Battery</h3>
                            <div class="side-right"></div>
                        </div>

                        <!-- GRID -->
                        <div class="comp-box" id="grid-box">
                            <img src="components/grid.png" alt="Grid" class="comp-img">
                            <div class="kw-tag" id="val-grid">0.0 kW</div>
                            <h3>Grid</h3>
                            <div class="side-right"></div>
                        </div>
                    </div>
                    <svg class="flow-container" id="flow-svg"></svg>
                </div>

                <!-- CHART & TOGGLES -->
                <div class="chart-container" id="main-chart-container">
                    <div class="chart-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <h3><i class="fas fa-microscope"></i> POWER ANALYTICS</h3>
                            <button id="btn-3d-toggle" class="btn-sm"
                                style="background:var(--primary); border:none; border-radius:8px; padding:4px 10px; font-size:0.7rem; color:white; cursor:pointer; box-shadow:0 4px 10px rgba(99,102,241,0.4);">
                                <i class="fas fa-cube"></i> 3D VIZ
                            </button>
                        </div>
                        <div class="chart-toggles">
                            <button class="toggle-btn active" data-index="0">SOLAR</button>
                            <button class="toggle-btn active" data-index="1">LOAD</button>
                            <button class="toggle-btn active" data-index="2">GRID</button>
                            <button class="toggle-btn active" data-index="3">SOC%</button>
                        </div>
                    </div>
                    <div class="chart-box">
                        <canvas id="liveChart"></canvas>
                    </div>
                </div>

                <!-- PERFORMANCE OVERVIEW (INTEGRATED) -->
                <div id="persistent-results" style="display: none;">
                    <div class="results-card">
                        <i class="fas fa-award celebrate-icon"></i>
                        <h2>SIMULATION PERFORMANCE</h2>
                        <div id="day-config-summary"
                            style="margin-top:10px; font-size: 0.75rem; color: var(--text-muted); padding: 10px; background: rgba(0,0,0,0.2); border-radius:15px; display:flex; justify-content:space-around; border: 1px solid var(--glass-border);">
                            <span>SOLAR: <b id="res-cfg-solar">5kW</b></span>
                            <span>BATT: <b id="res-cfg-batt">10kWh</b></span>
                            <span>MODE: <b id="res-cfg-mode">Smart</b></span>
                            <span>WEATHER: <b id="res-cfg-weather">Sunny</b></span>
                            <span>GRID COST: <b id="res-cfg-grid-cost">â‚¹10</b></span>
                        </div>
                        <div class="results-grid">
                            <div class="res-item"><span class="label">TOTAL COST</span>
                                <h1 id="res-cost-val">â‚¹0</h1>
                            </div>
                            <div class="res-item"><span class="label">SOLAR YIELD</span>
                                <h1 id="res-solar-val">0%</h1>
                            </div>
                            <div class="res-item"><span class="label">GRID FLOW</span>
                                <h1 id="res-grid-val">0 kWh</h1>
                            </div>
                            <div class="res-item"><span class="label">DIESEL</span>
                                <h1 id="res-diesel-val">0 kWh</h1>
                            </div>
                            <div class="res-item"><span class="label">BATTERY HEALTH</span>
                                <div class="soh-mini-gauge">
                                    <div class="soh-fill-res" id="res-soh-fill"></div>
                                </div>
                                <h1 id="res-soh-val">100%</h1>
                            </div>
                        </div>
                        <div id="savings-box" class="savings-banner" style="display:none;">
                            Smart Scheduler saved â‚¹<span id="res-savings">0</span> today!
                        </div>
                        <div class="action-btns">
                            <button class="btn btn-secondary" id="btn-compare"><i class="fas fa-chart-bar"></i> COMPARE
                                HISTORY</button>
                            <button class="btn btn-primary" id="btn-next-step">START NEW DAY</button>
                            <button class="btn btn-secondary btn-round" id="btn-download"><i
                                    class="fas fa-file-pdf"></i></button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- RIGHT: CONTROL & ANALYTICS -->
            <aside class="control-section">
                <!-- CONTROLS -->
                <div class="card control-card">
                    <h2><i class="fas fa-cogs"></i> CONFIGURATION</h2>
                    <div class="control-group">
                        <label>Weather Condition</label>
                        <div class="weather-grid">
                            <button class="weather-btn active" data-weather="sunny"><i class="fas fa-sun"></i>
                                Sunny</button>
                            <button class="weather-btn" data-weather="cloudy"><i class="fas fa-cloud"></i>
                                Cloudy</button>
                            <button class="weather-btn" data-weather="rainy"><i class="fas fa-droplet"></i>
                                Rainy</button>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>Solar Capacity: <span id="lbl-solar-cap">5 kW</span></label>
                        <input type="range" id="input-solar-cap" min="1" max="10" step="0.5" value="5">
                    </div>
                    <div class="control-group">
                        <label>Battery Capacity: <span id="lbl-batt-cap">10 kWh</span></label>
                        <input type="range" id="input-batt-cap" min="5" max="30" step="1" value="10">
                    </div>
                    <!-- NEW: GRID COST PARAMETER -->
                    <div class="control-group">
                        <label>Base Grid Cost (â‚¹/kWh): <span id="lbl-grid-cost">10</span></label>
                        <input type="range" id="input-grid-cost" min="1" max="25" step="1" value="10">
                    </div>
                    <div class="control-row" style="display:flex; gap:15px; align-items:flex-end;">
                        <div style="flex:1">
                            <label
                                style="font-size:0.75rem; color:var(--text-muted); display:block; margin-bottom:5px;">Smart
                                Scheduler</label>
                            <label class="switch">
                                <input type="checkbox" id="input-strategy">
                                <span class="slider"></span>
                            </label>
                            <p id="strategy-status" style="font-size:0.6rem; color:var(--text-muted); margin-top:4px;">
                                OFF</p>
                        </div>
                        <div style="flex:1">
                            <label
                                style="font-size:0.75rem; color:var(--text-muted); display:block; margin-bottom:5px;">Sim
                                Speed: <span id="lbl-speed">1x</span></label>
                            <input type="range" id="input-speed" min="1" max="4" value="1" style="height:15px;">
                        </div>
                    </div>
                    <div class="action-btns">
                        <button id="btn-start" class="btn btn-primary"><i class="fas fa-play"></i> RUN SIM</button>
                        <button id="btn-reset" class="btn btn-secondary"><i class="fas fa-redo"></i> RESET</button>
                    </div>
                </div>

                <!-- AUDIT PANEL -->
                <div class="card audit-card">
                    <div class="audit-header">
                        <h2><i class="fas fa-file-invoice"></i> AUDIT</h2>
                        <select class="hour-select" id="audit-hour">
                            <option value="-1">Real-time</option>
                            <script>for (let i = 0; i < 24; i++) document.write(`<option value="${i}">${i}:00</option>`);</script>
                        </select>
                    </div>
                    <table class="telemetry-table">
                        <thead>
                            <tr>
                                <th>SOURCE</th>
                                <th>KW</th>
                                <th>TOTAL</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="indicator" style="background:var(--solar)"></span>Solar</td>
                                <td id="tab-solar-kw">0.0</td>
                                <td id="tab-solar-kwh">0.0</td>
                            </tr>
                            <tr>
                                <td><span class="indicator" style="background:white"></span>Load</td>
                                <td id="tab-load-kw">0.0</td>
                                <td id="tab-load-kwh">0.0</td>
                            </tr>
                            <tr>
                                <td><span class="indicator" style="background:var(--battery)"></span>Batt</td>
                                <td id="tab-batt-kw">0.0</td>
                                <td id="tab-batt-kwh">0.0</td>
                            </tr>
                            <tr>
                                <td><span class="indicator" style="background:var(--grid)"></span>Grid</td>
                                <td id="tab-grid-kw">0.0</td>
                                <td id="tab-grid-kwh">0.0</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- BATTERY HEALTH -->
                    <div class="health-meter">
                        <label
                            style="font-size:0.7rem; color:var(--text-muted); display:flex; justify-content:space-between;">
                            BATT HEALTH (SOH) <span id="val-soh">100%</span>
                        </label>
                        <div class="meter-bg">
                            <div class="meter-fill" id="fill-soh"></div>
                        </div>
                        <p style="font-size:0.6rem; color:var(--text-muted); margin-top:5px; text-align:right;">Cycles
                            Remaining: <span id="val-cycles">1000</span></p>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- COMPARISON MODAL -->
    <div id="compare-modal" class="modal">
        <div class="modal-content">
            <div class="compare-header">
                <h2>ðŸ“Š PERFORMANCE COMPARISON</h2>
                <button class="btn btn-secondary" style="width:auto; padding:8px 20px"
                    onclick="document.getElementById('compare-modal').style.display='none'">CLOSE</button>
            </div>
            <div class="compare-grid" id="compare-grid-content">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>

</html>